<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Fakebook Messenger</title>
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Global Chat</h1>
    </header>

    <div id="chat_content">
        
    </div>

    <div class="chat-message">
        <input type="text" placeholder="Type a message" id="user-message">
        <button onclick="addUser()">Send</button>
    </div>

        
<script src="https://www.gstatic.com/firebasejs/5.8.3/firebase.js"></script>
<script>

   var username = prompt("Username");

  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyAI5916XcaPtU2eb0v4BqYSGNidGk81lD8",
    authDomain: "fir-website-fe172.firebaseapp.com",
    databaseURL: "https://fir-website-fe172.firebaseio.com",
    projectId: "fir-website-fe172",
    storageBucket: "fir-website-fe172.appspot.com",
    messagingSenderId: "1037296759944"
  };
  firebase.initializeApp(config);

  // setInterval(showUpdate, 50);  
  
  function showUpdate(){
    var output = document.getElementById("chat_content");
    
    output.innerHTML = "";
    
    var playersRef = firebase.database().ref("messages/");

    playersRef.on("child_added", function(data, prevChildKey) {
    var message = data.val();

    output.innerHTML += `
        <div class="container">
                <div class="chat-box">
                    <p class="username">${message.username}</p>
                    <p class="content">${message.content}</p>
                    <p class="time">${message.time}</p>
                </div>
        </div>
    `;
    });
   
  }

  showUpdate();


  function addUser(){
    var dbRef = firebase.database().ref();
    var usersRef = dbRef.child('messages');
    var newUserRef = usersRef.push();

    var content = document.getElementById('user-message').value;

    var date = new Date();

    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'pm' : 'am';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0'+minutes : minutes;
    var strTime = hours + ':' + minutes + ' ' + ampm;

    newUserRef.set({
        content: content,
        username: username,
        time: strTime
    });

  }

</script>



</body>
</html>